# 折腾经过

这次折腾的软路由是旁路由，其实是个网关服务器

## 安装方法

1. 用写盘软件（balenaEtcher）把镜像写到u盘里面。

   - 这里用的镜像是20200325，从波仔那里下载的。
   - 也可以用老白用的，更新而且功能更多
   - 老白的固件安装完要用科学上网ssr可能需要一个神秘代码，他视频那里有。我把它放在了文件夹里面

2. 把U盘插到旧电脑上，电脑通过网线接到路由器（第一次直接接到你用来做终端的电脑应该也可以，没网应该也进的去）从u盘启动系统

   - 其实可以调整启动顺序让U盘是第一启动项

3. 进入系统之后，等代码走到ipv6 is ready（大致这个意思）按一下回车，就会出现光标，进而可以输命令了

4. vi etc/config/network   把ip修改为你想用的（我用的后三位250），注意前三段不能改，只改后面的。

   - 这是vi的编辑模式，按一下insert键就可以编辑了，改完用esc退出编辑模式，:wq退出

5. 终端笔记本进入你设置的ip，进行设置：

   1. 网络-接口-lan-编辑

   2.  网关设置为主路由ip，

   3. 所有ipv6统统关掉，

   4. dhcp忽略此接口（后面有需要再开，第一次按最简单的来）。

      1. dhcp是给其他设备分发IP的功能，开了之后，其他终端不用改成静态ip也可以直接翻墙，不过我对软路由的希望是只能我自己用，并且不影响主网络。所以还是这样就可以

   5. 因为要翻墙，dns首选可以是网关地址，只填这一个也可以但是因为种种原因（听老白说是dns占用？）访问国内的速度会很慢（的确），所以可以多填几个离自己近的dns，这个可以搜一下比较快的dns。

      ![](E:\idm目录\软路由\1.png)

   6. passwall的设置，不用细说了，应该会了。

      - 开启负载均衡

   7. 开启dns加速

      ![](E:\idm目录\软路由\2.png)

6. 结束

7. 整体网络拓扑图

   ![](E:\idm目录\软路由\3.png)

8. 后来我打开了旁路由的dhcp，让旁路由不仅有了之前的网关服务器的功能，也有了路由的功能。打开方式：

   1. 直接在openwrt的接口界面不忽略

   2. 在主路由的管理界面，找到主路由的Dhcp，把网关改为旁路由的ip

      ## 知识

   ## 先写自己的理解，之后再补充

   ### 光猫

   有的光猫自己就是一个路由器，就是可以自己拨号，电脑可以直接连光猫就可以上网。但一般不是这个模式。

   更多的是光猫的桥接模式，光猫只有光信号转换的作用

   

   ### 路由器

   #### 模式

   路由器有很多模式，可以在不联网的时候设置，

   1. 我在后院的那个设置的是AP模式，作用是两个
      1. 交换机（尽管lan口有点少）
      2. 发出无线信号
   2. 还有拨号的模式，忘了名字了，我的主路由就可以拨号上网，这时从光猫lan口出来的网线接路由器的wan口

   ### IP，DNS，网关

   #### IP

   就像门牌号一样，标记终端设备谁是谁，但是如果是动态IP模式，IP会变得，即一个设备的ip并不是永久绑定的。有ipv4和ipv6两种，ipv6号称能给地球上每一粒沙子分配给ip

   ##### 公网IP

   并不是所有的家庭的网线都有公网ip，一般买云服务器，会送一个服务器的公网IP

   ##### 内网IP

   并不是所有的家庭的网线都有公网ip，可能一个楼只有一个公网ip。那自己家怎么和公网通信？这就要讲NAT技术了，样子再学

   ![](E:\idm目录\软路由\4.jpg)

   ##### 特殊的ip地址

   本机IP：127.0.0.1。可以说对每台电脑来说，它自己的IP就是这个

   ### 域名（Domain name）

   ![](E:\idm目录\软路由\5.jpg)

   一般购买并备案的域名都是2级域名

   ### 域名与IP的关系

   ![](E:\idm目录\软路由\6.jpg)

   IP很难记，所以用域名来表示，好记。

   **那我得到一个域名，怎么转化为IP？这就要用到DNS服务**

   

   ### DNS（域名服务）

   距离我们最近的dns，就是我们路由器上的dns。

   ### DDNS

   将ip与域名的关系登记到各个DNS服务器上